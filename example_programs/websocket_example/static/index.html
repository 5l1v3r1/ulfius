<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Websocket example</title>
  <link rel="stylesheet" href="styles.css">
</head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<body>
  <input type="button" id="connect" name="connect" value="Connect websocket"><br>
  <textarea name="sendMessage" id="sendMessage" cols="80" rows="20"></textarea><br>
  <input type="button" id="send" name="send" value="Send message">
  <input type="button" id="clear" name="clear" value="Clear messages"><br/>
  <hr>
  <div style="width=100%; height=100%" id="receivedMessage"></div>
</body>
<script type="text/javascript">
  $(document).ready(function() {
    var mySocket = false;
    function connectSocket() {
      mySocket = new WebSocket("ws://localhost:9275/websocket", ["plop", "grut"]);
      mySocket.onmessage = function (event) {
        var message = "<div><strong>Date: </strong>" + (new Date()).toLocaleDateString() + "</div><p><strong>Message: </strong>" + event.data + "</p><hr>"
        $("#receivedMessage").append(message);
      };
      mySocket.onclose = function () {
        var message = "<div><strong>Date: </strong>" + (new Date()).toLocaleDateString() + "</div><p><strong>Websocket closed</strong></p><hr>"
        $("#receivedMessage").append(message);
        $("#connect").val("Connect websocket");
      };
    }
    
    $("#connect").click(function() {
      if (!mySocket) {
        connectSocket();
        console.log("Start websocket: ", mySocket);
        $(this).val("Disconnect websocket");
      } else {
      mySocket.close();
      mySocket = false;
      console.log("Websocket closed");
      $(this).val("Connect websocket");
      }
    });
    
    $("#clear").click(function() {
      $("#receivedMessage").text("");
    });
    
    $("#send").click(function() {
      if ($("#sendMessage").val()) {
        if (!mySocket) {
          connectSocket();
        }
        mySocket.send($("#sendMessage").val());
        console.log("message sent: ", $("#sendMessage").val());
      }
    });
  });
</script>
</html>
